<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Kops on Autodidact by nature</title>
    <link>http://crisci.io/tags/kops/</link>
    <description>Recent content in Kops on Autodidact by nature</description>
    <generator>Hugo -- gohugo.io</generator>
    <copyright>&amp;copy; 2017. All rights reserved.</copyright>
    <lastBuildDate>Tue, 28 Feb 2017 00:00:00 +0000</lastBuildDate>
    <atom:link href="http://crisci.io/tags/kops/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Using kops to build your kubernetes cluster</title>
      <link>http://crisci.io/post/using-kops-to-manage-your-kubernetes-clusters/</link>
      <pubDate>Tue, 28 Feb 2017 00:00:00 +0000</pubDate>
      
      <guid>http://crisci.io/post/using-kops-to-manage-your-kubernetes-clusters/</guid>
      <description>

&lt;p&gt;kops is a tool used to deploy Kubernetes clusters on GCE/AWS that has recently gained more popularity.&lt;br&gt;
It&amp;rsquo;s quickly being developed and keeping up with the latest Kubernetes updates/features.&lt;br&gt;
There currently is only support for AWS/GCE but more platforms are planned to be supported.&lt;br&gt;&lt;/p&gt;

&lt;p&gt;I will cover the following topics:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Creating your own AWS Kubernetes installation with kops&lt;/li&gt;
&lt;li&gt;A look at what exactly is kops creating/storing inside its s3 bucket&lt;/li&gt;
&lt;li&gt;Adding a new worker node inside your cluster&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br&gt;&lt;/p&gt;

&lt;p&gt;You will need to have an existing AWS account with Access Keys setup.&lt;br&gt;
You will also need to install kubectl: &lt;a href=&#34;https://kubernetes.io/docs/user-guide/prereqs/&#34;&gt;https://kubernetes.io/docs/user-guide/prereqs/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;br&gt;&lt;/p&gt;

&lt;h1 id=&#34;install-kops&#34;&gt;Install kops&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span&gt;&lt;/span&gt;curl -Lo kops-darwin-amd64 https://github.com/kubernetes/kops/releases/download/1.5.1/kops-darwin-amd64 &amp;amp;&amp;amp; chmod +x kops-darwin-amd64 &amp;amp;&amp;amp; sudo mv kops-darwin-amd64 /usr/local/bin/kops
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;br&gt;&lt;/p&gt;

&lt;h1 id=&#34;create-your-cluster-spec&#34;&gt;Create your Cluster Spec&lt;/h1&gt;

&lt;p&gt;2 environment variables to export before we are ready to create our first Kubernetes cluster:&lt;br&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span&gt;&lt;/span&gt;export KOPS_STATE_STORE=s3://crisci-kops-state
export NAME=k8s.infradev.io
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The following command will create a cluster with default settings ( image/networking/instances sizes/etc )&lt;br&gt;&lt;br&gt;
Notice the &lt;strong&gt;&amp;ndash;admin-access &amp;ldquo;$(curl -s icanhazip.com)/32&amp;rdquo;&lt;/strong&gt; which will limit ssh/api-server connections to your source ip and not the default 0.0.0.0/0 so you don&amp;rsquo;t end up listed on &lt;a href=&#34;https://www.shodan.io/search?query=kubernetes&#34;&gt;shodan.io&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span&gt;&lt;/span&gt;kops create cluster --admin-access &amp;quot;$(curl -s icanhazip.com)/32&amp;quot; --cloud aws --zones eu-west-1a --node-count 1 --ssh-public-key ~/.ssh/kops_rsa.pub ${NAME}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;I0227 11:02:38.945869   41048 create_cluster.go:610] Using SSH public key: /Users/lcrisci/.ssh/kops_rsa.pub&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;I0227 11:02:39.658966   41048 subnets.go:183] Assigned CIDR 172.20.32.0/19 to subnet eu-west-1a&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;Previewing changes that will be made:&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;I0227 11:02:45.089285   41048 executor.go:91] Tasks: 0 done / 55 total; 27 can run&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;I0227 11:02:46.462817   41048 executor.go:91] Tasks: 27 done / 55 total; 12 can run&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;I0227 11:02:46.782909   41048 executor.go:91] Tasks: 39 done / 55 total; 14 can run&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;I0227 11:02:47.226994   41048 executor.go:91] Tasks: 53 done / 55 total; 2 can run&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;I0227 11:02:47.331107   41048 executor.go:91] Tasks: 55 done / 55 total; 0 can run&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;Will create resources:&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  AutoscalingGroup/master-eu-west-1a.masters.k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	MinSize             	1&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	MaxSize             	1&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	Subnets             	[name:eu-west-1a.k8s.infradev.io]&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	Tags                	{k8s.io/role/master: 1, Name: master-eu-west-1a.masters.k8s.infradev.io, KubernetesCluster: k8s.infradev.io}&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	LaunchConfiguration 	name:master-eu-west-1a.masters.k8s.infradev.io&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  AutoscalingGroup/nodes.k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	MinSize             	1&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	MaxSize             	1&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	Subnets             	[name:eu-west-1a.k8s.infradev.io]&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	Tags                	{k8s.io/role/node: 1, Name: nodes.k8s.infradev.io, KubernetesCluster: k8s.infradev.io}&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	LaunchConfiguration 	name:nodes.k8s.infradev.io&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  DHCPOptions/k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	DomainName          	eu-west-1.compute.internal&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	DomainNameServers   	AmazonProvidedDNS&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  EBSVolume/a.etcd-events.k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	AvailabilityZone    	eu-west-1a&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	VolumeType          	gp2&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	SizeGB              	20&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	Encrypted           	false&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	Tags                	{Name: a.etcd-events.k8s.infradev.io, KubernetesCluster: k8s.infradev.io, k8s.io/etcd/events: a/a, k8s.io/role/master: 1}&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  EBSVolume/a.etcd-main.k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	AvailabilityZone    	eu-west-1a&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	VolumeType          	gp2&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	SizeGB              	20&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	Encrypted           	false&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	Tags                	{k8s.io/etcd/main: a/a, k8s.io/role/master: 1, Name: a.etcd-main.k8s.infradev.io, KubernetesCluster: k8s.infradev.io}&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  IAMInstanceProfile/masters.k8s.infradev.io&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  IAMInstanceProfile/nodes.k8s.infradev.io&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  IAMInstanceProfileRole/masters.k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	InstanceProfile     	name:masters.k8s.infradev.io id:masters.k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	Role                	name:masters.k8s.infradev.io&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  IAMInstanceProfileRole/nodes.k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	InstanceProfile     	name:nodes.k8s.infradev.io id:nodes.k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	Role                	name:nodes.k8s.infradev.io&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  IAMRole/masters.k8s.infradev.io&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  IAMRole/nodes.k8s.infradev.io&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  IAMRolePolicy/additional.masters.k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	Role                	name:masters.k8s.infradev.io&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  IAMRolePolicy/additional.nodes.k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	Role                	name:nodes.k8s.infradev.io&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  IAMRolePolicy/masters.k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	Role                	name:masters.k8s.infradev.io&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  IAMRolePolicy/nodes.k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	Role                	name:nodes.k8s.infradev.io&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  InternetGateway/k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	VPC                 	name:k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	Shared              	false&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  Keypair/kubecfg&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	Subject             	cn=kubecfg&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	Type                	client&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  Keypair/kubelet&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	Subject             	cn=kubelet&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	Type                	client&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  Keypair/master&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	Subject             	cn=kubernetes-master&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	Type                	server&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	AlternateNames      	[100.64.0.1, api.internal.k8s.infradev.io, api.k8s.infradev.io, kubernetes, kubernetes.default, kubernetes.default.svc, kubernetes.default.svc.cluster.local]&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  LaunchConfiguration/master-eu-west-1a.masters.k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	ImageID             	kope.io/k8s-1.5-debian-jessie-amd64-hvm-ebs-2017-01-09&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	InstanceType        	m3.medium&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	SSHKey              	name:kubernetes.k8s.infradev.io-e3:6b:c5:df:a1:e3:ad:fe:16:6e:4d:10:35:dd:67:11 id:kubernetes.k8s.infradev.io-e3:6b:c5:df:a1:e3:ad:fe:16:6e:4d:10:35:dd:67:11&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	SecurityGroups      	[name:masters.k8s.infradev.io]&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	AssociatePublicIP   	true&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	IAMInstanceProfile  	name:masters.k8s.infradev.io id:masters.k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	RootVolumeSize      	20&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	RootVolumeType      	gp2&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	SpotPrice&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  LaunchConfiguration/nodes.k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	ImageID             	kope.io/k8s-1.5-debian-jessie-amd64-hvm-ebs-2017-01-09&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	InstanceType        	t2.medium&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	SSHKey              	name:kubernetes.k8s.infradev.io-e3:6b:c5:df:a1:e3:ad:fe:16:6e:4d:10:35:dd:67:11 id:kubernetes.k8s.infradev.io-e3:6b:c5:df:a1:e3:ad:fe:16:6e:4d:10:35:dd:67:11&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	SecurityGroups      	[name:nodes.k8s.infradev.io]&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	AssociatePublicIP   	true&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	IAMInstanceProfile  	name:nodes.k8s.infradev.io id:nodes.k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	RootVolumeSize      	20&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	RootVolumeType      	gp2&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	SpotPrice&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  ManagedFile/k8s.infradev.io-addons-bootstrap&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	Location            	addons/bootstrap-channel.yaml&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  ManagedFile/k8s.infradev.io-addons-core.addons.k8s.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	Location            	addons/core.addons.k8s.io/v1.4.0.yaml&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  ManagedFile/k8s.infradev.io-addons-dns-controller.addons.k8s.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	Location            	addons/dns-controller.addons.k8s.io/v1.5.1.yaml&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  ManagedFile/k8s.infradev.io-addons-kube-dns.addons.k8s.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	Location            	addons/kube-dns.addons.k8s.io/v1.5.1.yaml&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  ManagedFile/k8s.infradev.io-addons-limit-range.addons.k8s.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	Location            	addons/limit-range.addons.k8s.io/v1.5.0.yaml&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  ManagedFile/k8s.infradev.io-addons-storage-aws.addons.k8s.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	Location            	addons/storage-aws.addons.k8s.io/v1.5.0.yaml&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  Route/0.0.0.0/0&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	RouteTable          	name:k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	CIDR                	0.0.0.0/0&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	InternetGateway     	name:k8s.infradev.io&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  RouteTable/k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	VPC                 	name:k8s.infradev.io&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  RouteTableAssociation/eu-west-1a.k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	RouteTable          	name:k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	Subnet              	name:eu-west-1a.k8s.infradev.io&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  SSHKey/kubernetes.k8s.infradev.io-e3:6b:c5:df:a1:e3:ad:fe:16:6e:4d:10:35:dd:67:11&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	KeyFingerprint      	b9:09:b6:4c:49:ac:ce:cb:5a:f2:a5:79:b6:2e:e7:65&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  Secret/admin&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  Secret/kube&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  Secret/kube-proxy&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  Secret/kubelet&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  Secret/system-controller_manager&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  Secret/system-dns&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  Secret/system-logging&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  Secret/system-monitoring&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  Secret/system-scheduler&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  SecurityGroup/masters.k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	Description         	Security group for masters&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	VPC                 	name:k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	RemoveExtraRules    	[port=22, port=443, port=4001, port=4789, port=179]&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  SecurityGroup/nodes.k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	Description         	Security group for nodes&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	VPC                 	name:k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	RemoveExtraRules    	[port=22]&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  SecurityGroupRule/all-master-to-master&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	SecurityGroup       	name:masters.k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	SourceGroup         	name:masters.k8s.infradev.io&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  SecurityGroupRule/all-master-to-node&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	SecurityGroup       	name:nodes.k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	SourceGroup         	name:masters.k8s.infradev.io&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  SecurityGroupRule/all-node-to-node&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	SecurityGroup       	name:nodes.k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	SourceGroup         	name:nodes.k8s.infradev.io&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  SecurityGroupRule/https-external-to-master-x.x.x.x/32&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	SecurityGroup       	name:masters.k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	CIDR                	x.x.x.x/32&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	Protocol            	tcp&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	FromPort            	443&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	ToPort              	443&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  SecurityGroupRule/master-egress&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	SecurityGroup       	name:masters.k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	CIDR                	0.0.0.0/0&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	Egress              	true&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  SecurityGroupRule/node-egress&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	SecurityGroup       	name:nodes.k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	CIDR                	0.0.0.0/0&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	Egress              	true&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  SecurityGroupRule/node-to-master-tcp-4194&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	SecurityGroup       	name:masters.k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	Protocol            	tcp&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	FromPort            	4194&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	ToPort              	4194&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	SourceGroup         	name:nodes.k8s.infradev.io&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  SecurityGroupRule/node-to-master-tcp-443&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	SecurityGroup       	name:masters.k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	Protocol            	tcp&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	FromPort            	443&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	ToPort              	443&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	SourceGroup         	name:nodes.k8s.infradev.io&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  SecurityGroupRule/ssh-external-to-master-x.x.x.x/32&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	SecurityGroup       	name:masters.k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	CIDR                	x.x.x.x/32&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	Protocol            	tcp&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	FromPort            	22&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	ToPort              	22&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  SecurityGroupRule/ssh-external-to-node-x.x.x.x/32&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	SecurityGroup       	name:nodes.k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	CIDR                	x.x.x.x/32&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	Protocol            	tcp&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	FromPort            	22&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	ToPort              	22&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  Subnet/eu-west-1a.k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	VPC                 	name:k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	AvailabilityZone    	eu-west-1a&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	CIDR                	172.20.32.0/19&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	Shared              	false&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  VPC/k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	CIDR                	172.20.0.0/16&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	EnableDNSHostnames  	true&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	EnableDNSSupport    	true&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	Shared              	false&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  VPCDHCPOptionsAssociation/k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	VPC                 	name:k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	DHCPOptions         	name:k8s.infradev.io&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;Must specify --yes to apply changes&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;Cluster configuration has been created.&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;Suggestions:&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt; * list clusters with: kops get cluster&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt; * edit this cluster with: kops edit cluster k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt; * edit your node instance group: kops edit ig --name=k8s.infradev.io nodes&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt; * edit your master instance group: kops edit ig --name=k8s.infradev.io master-eu-west-1a&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;Finally configure your cluster with: kops update cluster k8s.infradev.io --yes&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;As you can see from the output above, kops will create and manage the following AWS resources for your new Kubernetes cluster:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;AWS&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;AutoscalingGroups&lt;/li&gt;
&lt;li&gt;DHCPOptions&lt;/li&gt;
&lt;li&gt;EBSVolumes&lt;/li&gt;
&lt;li&gt;IAMInstanceProfiles&lt;/li&gt;
&lt;li&gt;IAMInstanceProfileRoles&lt;/li&gt;
&lt;li&gt;IAMRoles&lt;/li&gt;
&lt;li&gt;IAMRolePolicies&lt;/li&gt;
&lt;li&gt;InternetGateway&lt;/li&gt;
&lt;li&gt;LaunchConfigurations&lt;/li&gt;
&lt;li&gt;Route&lt;/li&gt;
&lt;li&gt;RouteTable&lt;/li&gt;
&lt;li&gt;RouteTableAssociation&lt;/li&gt;
&lt;li&gt;SecurityGroups&lt;/li&gt;
&lt;li&gt;Subnet&lt;/li&gt;
&lt;li&gt;VPC&lt;/li&gt;
&lt;li&gt;VPCDHCPOptionsAssociation&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Kubernetes&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Keypairs&lt;/li&gt;
&lt;li&gt;ManagedFiles&lt;/li&gt;
&lt;li&gt;SSHKey&lt;/li&gt;
&lt;li&gt;Secrets&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;br&gt;&lt;/p&gt;

&lt;p&gt;Let&amp;rsquo;s have a look at the files generated by our previous command:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span&gt;&lt;/span&gt;aws s3 ls crisci-kops-state/k8s.infradev.io/ --recursive
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;2017-02-27 11:02:43       4659 k8s.infradev.io/cluster.spec&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;2017-02-27 11:02:42        837 k8s.infradev.io/config&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;2017-02-27 11:02:43        288 k8s.infradev.io/instancegroup/master-eu-west-1a&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;2017-02-27 11:02:43        274 k8s.infradev.io/instancegroup/nodes&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;2017-02-27 11:02:43        416 k8s.infradev.io/pki/ssh/public/admin/e36bc5dfa1e3adfe166e4d1035dd6711&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;One of them is the cluster.spec which contains the whole details about the cluster that will be created:&lt;br&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span&gt;&lt;/span&gt;aws s3 cp s3://crisci-kops-state/k8s.infradev.io/cluster.spec -
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;metadata:&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  Annotations: null&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  ClusterName: &amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  CreationTimestamp: null&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  DeletionGracePeriodSeconds: null&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  DeletionTimestamp: null&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  Finalizers: null&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  GenerateName: &amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  Generation: 0&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  Labels: null&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  Name: k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  Namespace: &amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  OwnerReferences: null&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  ResourceVersion: &amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  SelfLink: &amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  UID: &amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;spec:&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  api:&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    dns: {}&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  channel: stable&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  cloudProvider: aws&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  clusterDNSDomain: cluster.local&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  configBase: s3://crisci-kops-state/k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  configStore: s3://crisci-kops-state/k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  dnsZone: Z33Q1172C7EFWF&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  docker:&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    bridge: &amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    ipMasq: false&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    ipTables: false&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    logLevel: warn&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    storage: overlay,aufs&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    version: 1.12.3&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  etcdClusters:&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  - etcdMembers:&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    - instanceGroup: master-eu-west-1a&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;      name: a&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    name: main&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  - etcdMembers:&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    - instanceGroup: master-eu-west-1a&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;      name: a&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    name: events&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  keyStore: s3://crisci-kops-state/k8s.infradev.io/pki&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  kubeAPIServer:&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    address: 127.0.0.1&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    admissionControl:&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    - NamespaceLifecycle&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    - LimitRanger&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    - ServiceAccount&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    - PersistentVolumeLabel&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    - DefaultStorageClass&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    - ResourceQuota&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    allowPrivileged: true&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    anonymousAuth: false&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    apiServerCount: 1&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    basicAuthFile: /srv/kubernetes/basic_auth.csv&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    clientCAFile: /srv/kubernetes/ca.crt&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    cloudProvider: aws&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    etcdServers:&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    - http://127.0.0.1:4001&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    etcdServersOverrides:&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    - /events#http://127.0.0.1:4002&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    image: gcr.io/google_containers/kube-apiserver:v1.5.2&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    kubeletPreferredAddressTypes:&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    - InternalIP&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    - Hostname&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    - ExternalIP&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    - LegacyHostIP&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    logLevel: 2&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    pathSrvKubernetes: /srv/kubernetes&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    pathSrvSshproxy: /srv/sshproxy&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    securePort: 443&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    serviceClusterIPRange: 100.64.0.0/13&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    storageBackend: etcd2&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    tlsCertFile: /srv/kubernetes/server.cert&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    tlsPrivateKeyFile: /srv/kubernetes/server.key&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    tokenAuthFile: /srv/kubernetes/known_tokens.csv&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  kubeControllerManager:&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    allocateNodeCIDRs: true&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    attachDetachReconcileSyncPeriod: 1m0s&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    cloudProvider: aws&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    clusterCIDR: 100.96.0.0/11&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    clusterName: k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    configureCloudRoutes: true&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    image: gcr.io/google_containers/kube-controller-manager:v1.5.2&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    leaderElection:&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;      leaderElect: true&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    logLevel: 2&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    master: 127.0.0.1:8080&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    pathSrvKubernetes: /srv/kubernetes&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    rootCAFile: /srv/kubernetes/ca.crt&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    serviceAccountPrivateKeyFile: /srv/kubernetes/server.key&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  kubeDNS:&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    domain: cluster.local&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    image: gcr.io/google_containers/kubedns-amd64:1.3&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    replicas: 2&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    serverIP: 100.64.0.10&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  kubeProxy:&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    cpuRequest: 100m&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    image: gcr.io/google_containers/kube-proxy:v1.5.2&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    logLevel: 2&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    master: https://api.internal.k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  kubeScheduler:&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    image: gcr.io/google_containers/kube-scheduler:v1.5.2&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    leaderElection:&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;      leaderElect: true&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    logLevel: 2&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    master: 127.0.0.1:8080&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  kubelet:&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    allowPrivileged: true&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    apiServers: https://api.internal.k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    babysitDaemons: true&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    cgroupRoot: docker&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    cloudProvider: aws&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    clusterDNS: 100.64.0.10&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    clusterDomain: cluster.local&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    enableDebuggingHandlers: true&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    evictionHard: memory.available&amp;lt;100Mi,nodefs.available&amp;lt;10%,nodefs.inodesFree&amp;lt;5%,imagefs.available&amp;lt;10%,imagefs.inodesFree&amp;lt;5%&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    evictionPressureTransitionPeriod: 0s&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    hostnameOverride: &amp;#39;@aws&amp;#39;&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    logLevel: 2&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    networkPluginMTU: 9001&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    networkPluginName: kubenet&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    nonMasqueradeCIDR: 100.64.0.0/10&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    podManifestPath: /etc/kubernetes/manifests&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  kubernetesApiAccess:&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  - x.x.x.x/32&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  kubernetesVersion: 1.5.2&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  masterInternalName: api.internal.k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  masterKubelet:&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    allowPrivileged: true&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    apiServers: http://127.0.0.1:8080&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    babysitDaemons: true&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    cgroupRoot: docker&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    cloudProvider: aws&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    clusterDNS: 100.64.0.10&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    clusterDomain: cluster.local&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    enableDebuggingHandlers: true&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    evictionHard: memory.available&amp;lt;100Mi,nodefs.available&amp;lt;10%,nodefs.inodesFree&amp;lt;5%,imagefs.available&amp;lt;10%,imagefs.inodesFree&amp;lt;5%&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    evictionPressureTransitionPeriod: 0s&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    hostnameOverride: &amp;#39;@aws&amp;#39;&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    logLevel: 2&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    networkPluginMTU: 9001&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    networkPluginName: kubenet&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    nonMasqueradeCIDR: 100.64.0.0/10&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    podManifestPath: /etc/kubernetes/manifests&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    registerSchedulable: false&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  masterPublicName: api.k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  networkCIDR: 172.20.0.0/16&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  networking:&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    kubenet: {}&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  nonMasqueradeCIDR: 100.64.0.0/10&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  secretStore: s3://crisci-kops-state/k8s.infradev.io/secrets&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  serviceClusterIPRange: 100.64.0.0/13&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  sshAccess:&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  - x.x.x.x/32&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  subnets:&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  - cidr: 172.20.32.0/19&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    name: eu-west-1a&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    type: Public&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    zone: eu-west-1a&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  topology:&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    dns:&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;      type: Public&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    masters: public&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    nodes: public&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;br&gt;&lt;/p&gt;

&lt;h1 id=&#34;update-the-cluster&#34;&gt;Update the cluster&lt;/h1&gt;

&lt;p&gt;We now need to apply all these clusters settings created earlier and stored inside our S3 bucket:&lt;br&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span&gt;&lt;/span&gt;kops update cluster ${NAME} --yes
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;I0227 12:52:22.377172   41877 executor.go:91] Tasks: 0 done / 55 total; 27 can run&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;I0227 12:52:23.892835   41877 vfs_castore.go:422] Issuing new certificate: &amp;quot;kubelet&amp;quot;&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;I0227 12:52:23.979435   41877 vfs_castore.go:422] Issuing new certificate: &amp;quot;kubecfg&amp;quot;&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;I0227 12:52:24.453922   41877 vfs_castore.go:422] Issuing new certificate: &amp;quot;master&amp;quot;&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;I0227 12:52:26.781553   41877 executor.go:91] Tasks: 27 done / 55 total; 12 can run&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;I0227 12:52:28.123472   41877 executor.go:91] Tasks: 39 done / 55 total; 14 can run&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;I0227 12:52:30.072841   41877 launchconfiguration.go:302] waiting for IAM instance profile &amp;quot;nodes.k8s.infradev.io&amp;quot; to be ready&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;I0227 12:52:30.112320   41877 launchconfiguration.go:302] waiting for IAM instance profile &amp;quot;masters.k8s.infradev.io&amp;quot; to be ready&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;I0227 12:52:40.911275   41877 executor.go:91] Tasks: 53 done / 55 total; 2 can run&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;I0227 12:52:41.401692   41877 executor.go:91] Tasks: 55 done / 55 total; 0 can run&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;I0227 12:52:41.401765   41877 dns.go:140] Pre-creating DNS records&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;I0227 12:52:46.657056   41877 update_cluster.go:204] Exporting kubecfg for cluster&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;Wrote config for k8s.infradev.io to &amp;quot;/Users/lcrisci/.kube/config&amp;quot;&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;Kops has set your kubectl context to k8s.infradev.io&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;Cluster is starting.  It should be ready in a few minutes.&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;Suggestions:&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt; * list nodes: kubectl get nodes --show-labels&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt; * ssh to the master: ssh -i ~/.ssh/id_rsa admin@api.k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt; * read about installing addons: https://github.com/kubernetes/kops/blob/master/docs/addons.md&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;br&gt;&lt;/p&gt;

&lt;h1 id=&#34;validate-the-cluster&#34;&gt;Validate the cluster&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span&gt;&lt;/span&gt;kops validate cluster
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;Using cluster from kubectl context: k8s.infradev.io&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;Validating cluster k8s.infradev.io&lt;/span&gt;


&lt;span class=&#34;go&#34;&gt;cannot get nodes for &amp;quot;k8s.infradev.io&amp;quot;: Get https://api.k8s.infradev.io/api/v1/nodes: dial tcp 203.0.113.123:443: i/o timeout&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Our cluster is not yet ready and is still being created ( the api server is not responding yet ).&lt;br&gt;
&lt;strong&gt;203.0.113.123&lt;/strong&gt; is a placeholder ip part of the TEST-NET which kops is using as a dummy ip until the master(s) and it&amp;rsquo;s node(s) bootstrap properly and update their own ips&lt;/p&gt;

&lt;p&gt;&lt;br&gt;&lt;/p&gt;

&lt;p&gt;This is the output that we get after rerunning our validate command 5 minutes later:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;Using cluster from kubectl context: k8s.infradev.io&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;Validating cluster k8s.infradev.io&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;INSTANCE GROUPS&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;NAME			ROLE	MACHINETYPE	MIN	MAX	SUBNETS&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;master-eu-west-1a	Master	m3.medium	1	1	eu-west-1a&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;nodes			Node	t2.medium	1	1	eu-west-1a&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;NODE STATUS&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;NAME						ROLE	READY&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;ip-172-20-37-30.eu-west-1.compute.internal	node	True&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;ip-172-20-63-122.eu-west-1.compute.internal	master	True&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;Your cluster k8s.infradev.io is ready&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;br&gt;&lt;/p&gt;

&lt;p&gt;Let&amp;rsquo;s have a look at the state of our s3 bucket&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span&gt;&lt;/span&gt;aws s3 ls crisci-kops-state/k8s.infradev.io/ --recursive
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;2017-02-27 12:52:24        882 k8s.infradev.io/addons/bootstrap-channel.yaml&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;2017-02-27 12:52:24         61 k8s.infradev.io/addons/core.addons.k8s.io/v1.4.0.yaml&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;2017-02-27 12:52:24       1152 k8s.infradev.io/addons/dns-controller.addons.k8s.io/v1.5.1.yaml&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;2017-02-27 12:52:25       6977 k8s.infradev.io/addons/kube-dns.addons.k8s.io/v1.5.1.yaml&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;2017-02-27 12:52:24        166 k8s.infradev.io/addons/limit-range.addons.k8s.io/v1.5.0.yaml&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;2017-02-27 12:52:24        309 k8s.infradev.io/addons/storage-aws.addons.k8s.io/v1.5.0.yaml&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;2017-02-27 12:52:23       4677 k8s.infradev.io/cluster.spec&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;2017-02-27 11:02:42        837 k8s.infradev.io/config&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;2017-02-27 12:52:23        339 k8s.infradev.io/instancegroup/master-eu-west-1a&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;2017-02-27 12:52:23        325 k8s.infradev.io/instancegroup/nodes&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;2017-02-27 12:52:26       1046 k8s.infradev.io/pki/issued/ca/6391754630877149692432351200.crt&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;2017-02-27 12:52:27       1062 k8s.infradev.io/pki/issued/kubecfg/6391754626389335158749102511.crt&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;2017-02-27 12:52:27       1062 k8s.infradev.io/pki/issued/kubelet/6391754626058396578042878673.crt&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;2017-02-27 12:52:27       1302 k8s.infradev.io/pki/issued/master/6391754626239010186701887277.crt&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;2017-02-27 12:52:26       1675 k8s.infradev.io/pki/private/ca/6391754630877149692432351200.key&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;2017-02-27 12:52:26       1675 k8s.infradev.io/pki/private/kubecfg/6391754626389335158749102511.key&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;2017-02-27 12:52:26       1679 k8s.infradev.io/pki/private/kubelet/6391754626058396578042878673.key&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;2017-02-27 12:52:26       1675 k8s.infradev.io/pki/private/master/6391754626239010186701887277.key&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;2017-02-27 11:02:43        416 k8s.infradev.io/pki/ssh/public/admin/e36bc5dfa1e3adfe166e4d1035dd6711&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;2017-02-27 12:52:27         55 k8s.infradev.io/secrets/admin&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;2017-02-27 12:52:26         55 k8s.infradev.io/secrets/kube&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;2017-02-27 12:52:25         55 k8s.infradev.io/secrets/kube-proxy&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;2017-02-27 12:52:27         55 k8s.infradev.io/secrets/kubelet&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;2017-02-27 12:52:27         55 k8s.infradev.io/secrets/system:controller_manager&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;2017-02-27 12:52:26         55 k8s.infradev.io/secrets/system:dns&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;2017-02-27 12:52:26         55 k8s.infradev.io/secrets/system:logging&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;2017-02-27 12:52:27         55 k8s.infradev.io/secrets/system:monitoring&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;2017-02-27 12:52:26         55 k8s.infradev.io/secrets/system:scheduler&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;You will notice that new directories and their files were created by the update step:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;k8s.infradev.io/secrets/&lt;/strong&gt; contains a list of tokens generated per user/service&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;strong&gt;k8s.infradev.io/pki/&lt;/strong&gt; contains issued client certificates and private keys&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;strong&gt;k8s.infradev.io/addons/&lt;/strong&gt; contains addons installed by kops&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br&gt;&lt;/p&gt;

&lt;h1 id=&#34;kubectl-on-the-mic&#34;&gt;kubectl on the mic&lt;/h1&gt;

&lt;p&gt;We should be pointing to our new cluster:&lt;br&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span&gt;&lt;/span&gt;kubectl config get-contexts
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;CURRENT   NAME              CLUSTER           AUTHINFO          NAMESPACE&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;*         k8s.infradev.io   k8s.infradev.io   k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;          minikube          minikube          minikube&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span&gt;&lt;/span&gt;kubectl cluster-info
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;Kubernetes master is running at https://api.k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;KubeDNS is running at https://api.k8s.infradev.io/api/v1/proxy/namespaces/kube-system/services/kube-dns&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;To further debug and diagnose cluster problems, use &amp;#39;kubectl cluster-info dump&amp;#39;.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;A quick deployment to test our setup:&lt;br&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span&gt;&lt;/span&gt;kubectl run nginx --image=nginx --port=80
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span&gt;&lt;/span&gt;kubectl get all
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;NAME                        READY     STATUS    RESTARTS   AGE&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;po/nginx-3449338310-bxbjb   1/1       Running   0          50s&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;NAME             CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;svc/kubernetes   100.64.0.1   &amp;lt;none&amp;gt;        443/TCP   3m&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;NAME           DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;deploy/nginx   1         1         1            1           50s&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;NAME                  DESIRED   CURRENT   READY     AGE&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;rs/nginx-3449338310   1         1         1         50s&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Let&amp;rsquo;s forward the pod container locally and test our container:&lt;br&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span&gt;&lt;/span&gt;kubectl port-forward nginx-3449338310-bxbjb 8081:80
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;In another terminal, type the following:&lt;br&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span&gt;&lt;/span&gt;curl -I localhost:8081
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;You should get the following output ( a 200 OK )&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;HTTP/1.1 200 OK&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;Server: nginx/1.11.10&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;Date: Tue, 28 Feb 2017 09:35:01 GMT&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;Content-Type: text/html&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;Content-Length: 612&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;Last-Modified: Tue, 14 Feb 2017 15:36:04 GMT&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;Connection: keep-alive&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;ETag: &amp;quot;58a323e4-264&amp;quot;&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;Accept-Ranges: bytes&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;br&gt;&lt;/p&gt;

&lt;h1 id=&#34;it-s-your-turn-kops&#34;&gt;It&amp;rsquo;s your turn kops&lt;/h1&gt;

&lt;p&gt;Let&amp;rsquo;s have a look at our current instancegroups:&lt;br&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span&gt;&lt;/span&gt;kops get ig
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;Using cluster from kubectl context: k8s.infradev.io&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;NAME			ROLE	MACHINETYPE	MIN	MAX	SUBNETS&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;master-eu-west-1a	Master	m3.medium	1	1	eu-west-1a&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;nodes			Node	t2.medium	1	1	eu-west-1a&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id=&#34;adding-a-new-node-inside-our-cluster&#34;&gt;Adding a new node inside our cluster&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span&gt;&lt;/span&gt;kops edit ig nodes
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;You should get a similar view&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;apiVersion: kops/v1alpha2&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;kind: InstanceGroup&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;metadata:&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  creationTimestamp: &amp;quot;2017-02-28T08:08:10Z&amp;quot;&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  labels:&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    kops.k8s.io/cluster: k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  name: nodes&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;spec:&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  image: kope.io/k8s-1.5-debian-jessie-amd64-hvm-ebs-2017-01-09&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  machineType: t2.medium&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  maxSize: 1&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  minSize: 1&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  role: Node&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  subnets:&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  - eu-west-1a&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We will simply need to +1 the min/max Size entries before we can update our cluster with an extra node:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;apiVersion: kops/v1alpha2&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;kind: InstanceGroup&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;metadata:&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  creationTimestamp: &amp;quot;2017-02-28T08:08:10Z&amp;quot;&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  labels:&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;    kops.k8s.io/cluster: k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  name: nodes&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;spec:&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  image: kope.io/k8s-1.5-debian-jessie-amd64-hvm-ebs-2017-01-09&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  machineType: t2.medium&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  maxSize: 2&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  minSize: 2&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  role: Node&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  subnets:&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  - eu-west-1a&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Let&amp;rsquo;s do a quick dry-run to verify that our last edit will be correctly applied:&lt;br&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span&gt;&lt;/span&gt;kops update cluster
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;Using cluster from kubectl context: k8s.infradev.io&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;I0228 09:26:01.246915   56008 executor.go:91] Tasks: 0 done / 55 total; 27 can run&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;I0228 09:26:02.859778   56008 executor.go:91] Tasks: 27 done / 55 total; 12 can run&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;I0228 09:26:03.455066   56008 executor.go:91] Tasks: 39 done / 55 total; 14 can run&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;I0228 09:26:05.044053   56008 executor.go:91] Tasks: 53 done / 55 total; 2 can run&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;I0228 09:26:05.160390   56008 executor.go:91] Tasks: 55 done / 55 total; 0 can run&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;Will create resources:&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  IAMRolePolicy/additional.masters.k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	Role                	name:masters.k8s.infradev.io id:AROAJRW7FGIS3QZOECW26&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;  IAMRolePolicy/additional.nodes.k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	Role                	name:nodes.k8s.infradev.io id:AROAJ73WUQMRUWZQ4EYU4&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;Will modify resources:&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  AutoscalingGroup/nodes.k8s.infradev.io&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	MinSize             	 1 -&amp;gt; 2&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;  	MaxSize             	 1 -&amp;gt; 2&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;Must specify --yes to apply changes&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;That looks good to me, let&amp;rsquo;s update our cluster:&lt;br&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span&gt;&lt;/span&gt;kops update cluster --yes
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;Using cluster from kubectl context: k8s.infradev.io&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;I0228 09:26:37.155218   56196 executor.go:91] Tasks: 0 done / 55 total; 27 can run&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;I0228 09:26:38.504246   56196 executor.go:91] Tasks: 27 done / 55 total; 12 can run&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;I0228 09:26:39.285901   56196 executor.go:91] Tasks: 39 done / 55 total; 14 can run&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;I0228 09:26:40.634271   56196 executor.go:91] Tasks: 53 done / 55 total; 2 can run&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;I0228 09:26:40.869591   56196 executor.go:91] Tasks: 55 done / 55 total; 0 can run&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;I0228 09:26:40.869646   56196 dns.go:140] Pre-creating DNS records&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;I0228 09:26:41.571104   56196 update_cluster.go:204] Exporting kubecfg for cluster&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;Wrote config for k8s.infradev.io to &amp;quot;/Users/lcrisci/.kube/config&amp;quot;&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;Kops has set your kubectl context to k8s.infradev.io&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;Cluster changes have been applied to the cloud.&lt;/span&gt;


&lt;span class=&#34;go&#34;&gt;Changes may require instances to restart: kops rolling-update cluster&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We don&amp;rsquo;t need any rolling-update in this context so all we need to do is to be patient until the new node gets provisioned:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span&gt;&lt;/span&gt;kubectl get nodes -o wide
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;NAME                                          STATUS         AGE       EXTERNAL-IP&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;ip-172-20-33-218.eu-west-1.compute.internal   Ready          1m        34.251.a.b&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;ip-172-20-40-211.eu-west-1.compute.internal   Ready          15m       34.251.c.d&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;ip-172-20-53-218.eu-west-1.compute.internal   Ready,master   17m       34.251.e.f&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;So we&amp;rsquo;ve got a new node as part of our default nodes ig which we can connect to via ssh:&lt;br&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span&gt;&lt;/span&gt;ssh -i ~/.ssh/kops_rsa admin@34.251.a.b
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;The authenticity of host &amp;#39;34.251.a.b (34.251.a.b)&amp;#39; can&amp;#39;t be established.&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;ECDSA key fingerprint is SHA256:6q+Fidr35O11vCU3AUgNrvtNTMWLvFrlWXxM01YKw3s.&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;Are you sure you want to continue connecting (yes/no)? yes&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;Warning: Permanently added &amp;#39;34.251.a.b&amp;#39; (ECDSA) to the list of known hosts.&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;The programs included with the Debian GNU/Linux system are free software;&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;the exact distribution terms for each program are described in the&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;individual files in /usr/share/doc/*/copyright.&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;permitted by applicable law.&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;_____________________________________________________________________&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;WARNING! Your environment specifies an invalid locale.&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt; This can affect your user experience significantly, including the&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt; ability to manage packages. You may install the locales by running:&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;   sudo apt-get install language-pack-en&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;     or&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;   sudo locale-gen en_GB.UTF-8&lt;/span&gt;

&lt;span class=&#34;go&#34;&gt;To see all available language packs, run:&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;   apt-cache search &amp;quot;^language-pack-[a-z][a-z]$&amp;quot;&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;To disable this message for all users, run:&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;   sudo touch /var/lib/cloud/instance/locale-check.skip&lt;/span&gt;
&lt;span class=&#34;go&#34;&gt;_____________________________________________________________________&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;A quick check of the uptime just because I love to run commands:&lt;br&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span&gt;&lt;/span&gt;admin@ip-172-20-33-218:~$ uptime
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt; 08:31:15 up 3 min,  1 user,  load average: 0.19, 0.28, 0.13&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This node is definitely new and ready to run our containers&lt;/p&gt;

&lt;p&gt;&lt;br&gt;&lt;/p&gt;

&lt;h1 id=&#34;delete-the-cluster&#34;&gt;Delete the cluster&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span&gt;&lt;/span&gt;kops delete cluster k8s.infradev.io --yes
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id=&#34;summary&#34;&gt;Summary&lt;/h1&gt;

&lt;p&gt;I showed you what a simple default install of kops on AWS looked like.It&amp;rsquo;s quite straightforward and kops is already very advanced on the AWS integration side.&lt;br&gt;&lt;br&gt;&lt;/p&gt;

&lt;p&gt;kops supports many different flags when creating a cluster, one of the most important for an advanced cluster being the &lt;strong&gt;&amp;ndash;networking&lt;/strong&gt; to install an overlay network and make it possible to define complex network policies and rules for interactions between different containers.&lt;br&gt;&lt;br&gt;&lt;/p&gt;

&lt;p&gt;I&amp;rsquo;m planning to write more advanced posts around kops and automation in general.They will also cover advanced networking setups and different HA/Autoscaling and Backups/Restores scenarios.&lt;/p&gt;

&lt;p&gt;&lt;br&gt;&lt;/p&gt;

&lt;h1 id=&#34;resources&#34;&gt;Resources&lt;/h1&gt;

&lt;p&gt;Slack: &lt;a href=&#34;http://slack.k8s.io/&#34;&gt;http://slack.k8s.io/&lt;/a&gt; ( #kops )&lt;br&gt;
Github: &lt;a href=&#34;https://github.com/kubernetes/kops&#34;&gt;https://github.com/kubernetes/kops&lt;/a&gt;&lt;br&gt;
Docs: &lt;a href=&#34;https://github.com/kubernetes/kops/tree/master/docs&#34;&gt;https://github.com/kubernetes/kops/tree/master/docs&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>